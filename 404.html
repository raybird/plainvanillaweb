<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é é¢è½‰å‘ä¸­... | Plain Vanilla Web</title>
    <script>
        // GitHub Pages SPA è·¯ç”±ä¿®å¾© (404 Hack)
        // ç•¶ä½¿ç”¨è€…è¨ªå•é Hash è·¯å¾‘ (ä¾‹å¦‚ /search) æ™‚ï¼ŒGitHub Pages æœƒå›å‚³æ­¤ 404 é é¢ã€‚
        // æ­¤è…³æœ¬æœƒå°‡è·¯å¾‘è½‰æ›ç‚º Hash è·¯ç”± (/#/search) ä¸¦é‡å®šå‘å› index.htmlã€‚
        
        const path = window.location.pathname;
        const repo = '/plainvanillaweb'; // æ‚¨çš„ Repository åç¨±
        
        // ç§»é™¤ repo å‰ç¶´ä»¥å–å¾—å¯¦éš›è·¯ç”±
        let route = path.replace(repo, '');
        if (route.startsWith('/')) route = route.substring(1);
        
        // å¦‚æœé‚„æœ‰ query string æˆ– hashï¼Œä¹Ÿä¸€ä½µä¿ç•™
        const search = window.location.search;
        const hash = window.location.hash;

        // å»ºæ§‹æ–°çš„ Hash URL
        // ä¾‹å¦‚ï¼š/plainvanillaweb/worker -> /plainvanillaweb/#/worker
        const newUrl = `${window.location.protocol}//${window.location.host}${repo}/#/${route}${search}${hash}`;
        
        // é˜²ç„¡çª®è¿´åœˆæ©Ÿåˆ¶ï¼šè‹¥ 2 ç§’å…§é€£çºŒç™¼ç”Ÿè¶…é 3 æ¬¡é‡å®šå‘ï¼Œå‰‡ä¸­æ–·
        const redirectCountKey = 'gh-pages-redirect-count';
        const lastRedirectTimeKey = 'gh-pages-redirect-time';
        const now = Date.now();
        const lastTime = parseInt(sessionStorage.getItem(lastRedirectTimeKey) || '0', 10);
        let count = parseInt(sessionStorage.getItem(redirectCountKey) || '0', 10);

        if (now - lastTime > 2000) {
            count = 0; // è¶…é 2 ç§’ï¼Œé‡ç½®è¨ˆæ•¸
        }

        if (count >= 3) {
            console.error('[404 Fix] Detected infinite redirect loop. Stopping redirection.');
            document.addEventListener("DOMContentLoaded", () => {
                document.body.innerHTML = `<h2>ğŸš« è¼‰å…¥å¤±æ•—</h2><p>ç³»çµ±åµæ¸¬åˆ°ç„¡çª®çš„é‡æ–°å°å‘è¿´åœˆï¼Œç‚ºä¿è­·æ‚¨çš„ç€è¦½å™¨å·²ä¸­æ–·è¼‰å…¥ã€‚</p><p>è«‹å˜—è©¦æ¸…é™¤å¿«å–ã€å–æ¶ˆè¨»å†Š Service Workerï¼Œæˆ–è¿”å› <a href="${repo}/">é¦–é </a>ã€‚</p>`;
            });
        } else {
            sessionStorage.setItem(redirectCountKey, (count + 1).toString());
            sessionStorage.setItem(lastRedirectTimeKey, now.toString());
            
            console.log(`[404 Fix] Redirecting from ${path} to ${newUrl}`);
            window.location.replace(newUrl);
        }
    </script>
</head>
<body>
    <p>æ­£åœ¨ç‚ºæ‚¨å°å‘è‡³æ­£ç¢ºé é¢...</p>
</body>
</html>
