# ADR 0031: 跨分頁狀態同步機制 (Cross-tab State Synchronization)

## 上下文
在現代網頁應用中，使用者可能會同時開啟多個標籤頁。若各分頁間的狀態（如主題、通知、搜尋歷史）不一致，會導致使用者體驗破碎且混亂。

## 決策
實作 **`BroadcastService`**，利用瀏覽器原生的 **`BroadcastChannel`** API。
1.  **實時同步**: 當 `appStore` 在一個分頁中發生變更時，自動廣播 `sync_state` 訊息給其他同源分頁。
2.  **無感更新**: 接收分頁在收到訊息後，直接修改底層狀態並觸發 UI 更新，無需使用者手動重新整理。
3.  **防迴圈機制**: 透過標記同步來源 (Tab ID) 並直接操作底層對象（避開 Proxy 攔截），防止訊息在分頁間無限循環。
4.  **監控 UI**: 在 Dashboard 中展示同步動態（最後來源分頁、同步次數），增強可觀測性。

## 後果
- **優點**: 提供無縫的多分頁協作體驗，數據始終保持一致。
- **優點**: 作為教學範例，展示了瀏覽器原生進程間通訊 (IPC) 的實踐。
- **缺點**: 由於 `BroadcastChannel` 無法跨域，此機制僅限於同一個域名下的分頁。
