# ADR 0034: 離線動作同步機制 (Offline Action Sync Mechanism)

## 上下文
在單頁應用 (SPA) 中，使用者若在離線狀態下執行重要操作（如修改個人資料），傳統做法通常是直接報錯。為了提升應用的韌性，我們需要一種能在恢復連線後自動補償同步的機制。

## 決策
實作基於 **IndexedDB** 的離線動作佇列與 **`SyncService`**：
1.  **多 Store 擴充**: 重構 `IDBService` 以支援多個 Object Store，並新增 `actions_queue` 用於持久化離線動作。
2.  **動作排隊**: 當使用者執行操作且處於離線（或作為通用後台處理）時，動作會被存入 `actions_queue` 並標記類型與數據。
3.  **自動同步**: `SyncService` 監聽 `ConnectivityService` 的連線恢復事件。一旦偵測到恢復連線，自動遍歷佇列並執行模擬的 API 同步請求。
4.  **UI 整合**: 在 Dashboard 提供即時佇列計數與「立即同步」按鈕，並在動作成功同步後透過通知系統反饋。

## 後果
- **優點**: 極大提升了離線環境下的使用者體驗，數據不因暫時斷網而丟失。
- **優點**: 架構上實現了真正的「離線優先 (Offline-first)」開發模式。
- **缺點**: 由於目前為模擬同步，未來整合真實後端時，需考慮複雜的衝突解決 (Conflict Resolution) 策略。
