# ADR 0047: 原生 Compression Streams 數據優化

## 上下文
對於離線應用，IndexedDB 或 API 的數據傳輸與存儲量可能隨著時間顯著增加。傳統上，開發者會引入 `pako` 或 `zlib` 等 JS 庫。然而，現代瀏覽器已內建高效的 `CompressionStream` 與 `DecompressionStream`。

## 決策
1.  **原生串流壓縮**: 採用 `CompressionStream('gzip')` 進行數據寫入時的流式壓縮。
2.  **存儲優化**: 在 `idb-service.js` 中整合壓縮邏輯，讓資料在存入 IndexedDB 前即完成體積縮減，優化儲存配額。
3.  **無感解壓**: 在讀取資料時，自動識別數據格式並進行流式解壓，確保開發者介面透明化。

## 狀態
**Accepted (2026-02-18)**

## 後果
- **優點**: 在不增加 Bundle Size 的前提下大幅減少數據存儲空間。
- **優點**: 展示了瀏覽器原生「串流 (Streams)」處理在數據工程中的優雅應用。
- **缺點**: 對於極小片段的數據，壓縮開銷可能超過空間節省量（本實作中實施 1KB 以上才壓縮的閾值判斷）。
